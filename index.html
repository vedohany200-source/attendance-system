
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صيدلية د.رامي | نظام الحضور</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; }
        .timer { font-family: monospace; letter-spacing: 2px; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4" id="app">
        <!-- سيتم تحميل المحتوى هنا -->
    </div>

    <script>
        // بيانات الأطباء مع الأكواد الجديدة
        const system = {
            admins: [
                {name: "دكتور رامي كميل", code: "RK36", type: "admin"}
            ],
            doctors: [
                {name: "دكتوره روجينا", code: "RA12", shift: {start: 10, end: 18}},
                {name: "دكتوره مارينا", code: "MH20", shift: {start: 12, end: 20}},
                {name: "دكتوره كاتي", code: "KK00", shift: {start: 18, end: 3}},
                {name: "دكتور فادي", code: "FH99", shift: {start: 18, end: 3}},
                {name: "جرجس هلال", code: "GH78", shift: {start: 14, end: 0}},
                {name: "يوسف ثروت", code: "YT56", shift: {start: 10, end: 20}},
                {name: "فادي ميلاد", code: "FM90", shift: {start: 17, end: 3}}
            ],
            records: JSON.parse(localStorage.getItem('records')) || []
        };

        // تطبيق النظام
        const app = {
            currentDoctor: null,
            
            init() {
                this.renderLogin();
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
            },

            renderLogin() {
                document.getElementById('app').innerHTML = `
                    <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 mt-10">
                        <h1 class="text-2xl font-bold text-center text-blue-700 mb-6">
                            نظام حضور صيدلية د.رامي
                        </h1>
                        
                        <div class="mb-4">
                            <label class="block mb-2 font-medium">الكود السري:</label>
                            <input type="password" id="empCode" 
                                   class="w-full p-3 border rounded-lg" 
                                   placeholder="أدخل كود الدخول">
                        </div>
                        
                        <button onclick="app.login()" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold">
                            دخول النظام
                        </button>
                        
                        <div class="mt-4 text-center text-gray-700">
                            <div id="liveClock" class="text-lg font-bold"></div>
                        </div>
                    </div>
                `;
            },

            login() {
                const code = document.getElementById('empCode').value.trim();
                if (!code) return alert("يجب إدخال كود الدخول");
                
                this.currentDoctor = [...system.admins, ...system.doctors].find(u => u.code === code);
                
                if (!this.currentDoctor) {
                    alert("كود الدخول غير صحيح");
                    document.getElementById('empCode').value = "";
                    return;
                }
                
                if (this.currentDoctor.type === "admin") {
                    this.renderAdminPanel();
                } else {
                    this.renderDoctorPanel();
                }
            },

            renderAdminPanel() {
                document.getElementById('app').innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h1 class="text-xl font-bold mb-4">لوحة الأدمن</h1>
                        
                        <div class="flex gap-2 mb-6">
                            <button onclick="app.showRecords('today')" class="bg-blue-500 text-white px-4 py-2 rounded">
                                سجلات اليوم
                            </button>
                            <button onclick="app.showRecords('all')" class="bg-green-500 text-white px-4 py-2 rounded">
                                جميع السجلات
                            </button>
                            <button onclick="app.showVacationRequests()" class="bg-yellow-500 text-white px-4 py-2 rounded">
                                طلبات الإجازة
                            </button>
                            <button onclick="app.showAbsences()" class="bg-red-500 text-white px-4 py-2 rounded">
                                غيابات الشهر
                            </button>
                        </div>
                        
                        <div id="recordsView" class="border rounded-lg p-3">
                            <!-- عرض السجلات هنا -->
                        </div>
                        
                        <button onclick="app.renderLogin()" class="mt-4 text-red-500">
                            تسجيل خروج
                        </button>
                    </div>
                `;
                this.showRecords('today');
            },

            renderDoctorPanel() {
                document.getElementById('app').innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h1 class="text-xl font-bold text-blue-700">
                                ${this.currentDoctor.name}
                            </h1>
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                ${this.getShiftTime()}
                            </span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <button onclick="app.checkIn()" 
                                    class="bg-green-500 hover:bg-green-600 text-white py-3 px-2 rounded-lg">
                                تسجيل حضور
                            </button>
                            <button onclick="app.checkOut()" 
                                    class="bg-red-500 hover:bg-red-600 text-white py-3 px-2 rounded-lg">
                                تسجيل انصراف
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <h3 class="font-bold mb-3">طلب إجازة</h3>
                            <input type="date" id="vacationDate" class="w-full p-2 border rounded mb-2">
                            <button onclick="app.requestVacation()" 
                                    class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded">
                                تقديم طلب
                            </button>
                        </div>
                        
                        <div class="border rounded-lg p-3">
                            <h4 class="font-bold mb-2">آخر السجلات</h4>
                            <div id="lastRecords"></div>
                        </div>
                        
                        <button onclick="app.renderLogin()" class="mt-4 text-blue-500">
                            العودة للرئيسية
                        </button>
                    </div>
                `;
                this.loadLastRecords();
            },

            getShiftTime() {
                const shift = this.currentDoctor.shift;
                const start = shift.start > 12 ? shift.start - 12 + 'PM' : shift.start + 'AM';
                let end = shift.end > 12 ? shift.end - 12 + 'PM' : shift.end + 'AM';
                if (shift.end === 0) end = '12AM';
                return `شيفت ${start} - ${end}`;
            },

            checkIn() {
                if (!this.checkShiftTime()) {
                    alert(`وقت الشيفت يبدأ من ${this.getShiftTime()}`);
                    return;
                }
                
                const now = new Date();
                const today = this.formatDate(now);
                
                if (system.records.some(r => 
                    r.name === this.currentDoctor.name && 
                    r.type === 'حضور' && 
                    r.date === today
                )) {
                    alert('لقد قمت بتسجيل الحضور مسبقاً اليوم');
                    return;
                }
                
                system.records.push({
                    name: this.currentDoctor.name,
                    type: 'حضور',
                    time: this.formatTime(now),
                    date: today,
                    timestamp: Date.now()
                });
                
                localStorage.setItem('records', JSON.stringify(system.records));
                alert('تم تسجيل الحضور بنجاح');
                this.loadLastRecords();
            },

            checkOut() {
                const now = new Date();
                const today = this.formatDate(now);
                
                if (!system.records.some(r => 
                    r.name === this.currentDoctor.name && 
                    r.type === 'حضور' && 
                    r.date === today
                )) {
                    alert('يجب تسجيل الحضور أولاً قبل الانصراف');
                    return;
                }
                
                if (system.records.some(r => 
                    r.name === this.currentDoctor.name && 
                    r.type === 'انصراف' && 
                    r.date === today
                )) {
                    alert('لقد قمت بتسجيل الانصراف مسبقاً اليوم');
                    return;
                }
                
                system.records.push({
                    name: this.currentDoctor.name,
                    type: 'انصراف',
                    time: this.formatTime(now),
                    date: today,
                    timestamp: Date.now()
                });
                
                localStorage.setItem('records', JSON.stringify(system.records));
                alert('تم تسجيل الانصراف بنجاح');
                this.loadLastRecords();
            },

            requestVacation() {
                const date = document.getElementById('vacationDate').value;
                if (!date) return alert('يجب اختيار تاريخ الإجازة');
                
                system.records.push({
                    name: this.currentDoctor.name,
                    type: 'إجازة',
                    date: date,
                    timestamp: Date.now()
                });
                
                localStorage.setItem('records', JSON.stringify(system.records));
                alert('تم تقديم طلب الإجازة بنجاح');
                document.getElementById('vacationDate').value = '';
            },

            checkShiftTime() {
                const now = new Date();
                const currentHour = now.getHours();
                const shift = this.currentDoctor.shift;
                
                if (shift.start > shift.end) {
                    return currentHour >= shift.start || currentHour < shift.end;
                } else {
                    return currentHour >= shift.start && currentHour < shift.end;
                }
            },

            loadLastRecords() {
                const lastRecords = system.records
                    .filter(r => r.name === this.currentDoctor.name)
                    .sort((a, b) => b.timestamp - a.timestamp)
                    .slice(0, 5);
                
                let html = lastRecords.map(r => `
                    <div class="p-2 border-b">
                        ${r.date} - ${r.time || ''} | ${r.type}
                    </div>
                `).join('');
                
                document.getElementById('lastRecords').innerHTML = html || 'لا توجد سجلات سابقة';
            },

            showRecords(type) {
                const records = type === 'today' ? 
                    system.records.filter(r => r.date === this.formatDate(new Date())) :
                    [...system.records].sort((a, b) => b.timestamp - a.timestamp);
                
                let html = records.map(r => `
                    <div class="p-3 border-b flex justify-between">
                        <div>
                            <span class="font-bold">${r.name}</span>
                            <span class="mx-2">|</span>
                            <span>${r.type}</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            ${r.date} ${r.time || ''}
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('recordsView').innerHTML = html || 'لا توجد سجلات';
            },

            showVacationRequests() {
                const vacationRecords = system.records.filter(r => r.type === 'إجازة');
                let html = vacationRecords.map(r => `
                    <div class="p-3 border-b flex justify-between">
                        <div>
                            <span class="font-bold">${r.name}</span>
                            <span class="mx-2">|</span>
                            <span>إجازة</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            ${r.date}
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('recordsView').innerHTML = html || 'لا توجد طلبات إجازة';
            },

            showAbsences() {
                const currentMonth = new Date().getMonth() + 1; // الأشهر تبدأ من 0
                const absenceRecords = system.records.filter(r => r.type === 'غياب' && new Date(r.date).getMonth() + 1 === currentMonth);
                let html = absenceRecords.map(r => `
                    <div class="p-3 border-b flex justify-between">
                        <div>
                            <span class="font-bold">${r.name}</span>
                            <span class="mx-2">|</span>
                            <span>غياب</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            ${r.date}
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('recordsView').innerHTML = html || 'لا توجد غيابات لهذا الشهر';
            },

            formatDate(date) {
                const d = new Date(date);
                const year = d.getFullYear();
                const month = (d.getMonth() + 1).toString().padStart(2, '0');
                const day = d.getDate().toString().padStart(2, '0');
                return `${year}-${month}-${day}`;
            },

            formatTime(date) {
                const d = new Date(date);
                let hours = d.getHours();
                const minutes = d.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12;
                return `${hours}:${minutes} ${ampm}`;
            },

            updateClock() {
                const now = new Date();
                const time = this.formatTime(now);
                if (document.getElementById('liveClock')) {
                    document.getElementById('liveClock').textContent = time;
                }
            }
        };

        // بدء النظام
        app.init();
    </script>
</body>
</html>