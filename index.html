<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù â€” powred by fady</title>
<style>
:root{
  --bg:#f5f8fb; --card:#fff; --accent:#1565c0; --accent-2:#0288d1; --muted:#6b7785; --danger:#e53935; --ok:#2e7d32;
}
*{box-sizing:border-box}
body{margin:0;padding:14px;font-family:'Segoe UI',Tahoma,Arial,sans-serif;background:var(--bg);color:#0f1720}
.wrap{max-width:900px;margin:0 auto}
header{display:flex;flex-direction:column;align-items:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;padding:12px;border-radius:10px;text-align:center;}
header h1{margin:0;font-size:18px} header .sub{font-size:13px;opacity:.95}
.card{background:var(--card);border-radius:12px;padding:12px;margin-top:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);border:1px solid rgba(16,24,40,.04);}
h2{margin:0 0 8px;color:var(--accent)}
table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
th,td{padding:6px;border-bottom:1px solid #eef3f7;text-align:center}
th{background:linear-gradient(180deg,#f7fbff,#f0f6ff);color:var(--accent);font-weight:700}
select,input[type=text]{padding:6px;border-radius:6px;border:1px solid #d7e6f6;background:#fbfeff;font-size:13px;width:100%}
button{padding:6px 10px;border-radius:6px;border:0;cursor:pointer;font-size:13px}
.btn-blue{background:var(--accent);color:#fff;margin:2px;}
.reasonInput{width:90%;margin-top:4px}
footer{margin-top:14px;text-align:center;color:#6b7785;font-weight:600;font-size:13px}
.messageDiv{padding:8px;margin:6px 0;border-radius:6px;color:#fff;font-weight:600;text-align:center;}
.message-success{background:#2e7d32;}
.message-info{background:#1565c0;}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>âš•ï¸ Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù</h1>
<div class="sub">Ù†Ø³Ø®Ø© ÙƒØ§Ù…Ù„Ø© â€” powred by fady</div>
</header>

<div class="card">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h2>
<table id="peopleTable">
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø´ÙŠÙØª</th><th>Ø¥Ø¬Ø§Ø²Ø©</th><th>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„</th><th>Ø­Ø¶ÙˆØ±</th><th>Ø§Ù†ØµØ±Ø§Ù</th></tr></thead>
<tbody></tbody>
</table>
</div>

<div class="card">
<h2>Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…</h2>
<table id="logTable">
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù†ÙˆØ¹</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø³Ø¨Ø¨</th></tr></thead>
<tbody></tbody>
</table>
<button class="btn-blue" onclick="sendWeeklyReport()">Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>

<footer>
ØªØ­Øª Ø¥Ø´Ø±Ø§Ù: Ø¯ÙƒØªÙˆØ± Ø±Ø§Ù…ÙŠ ÙƒÙ…ÙŠÙ„
</footer>
</div>

<script>
const adminEmail = "vedohany200@gmail.com";
function isAdmin(){
  const email = prompt("Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„ØªØ­Ù‚Ù‚ ÙƒØ£Ø¯Ù…Ù†:");
  if(email === adminEmail){alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù† âœ…"); return true;}
  else {alert("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ùƒ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âŒ"); return false;}
}

let people = [
  { name:"Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§",shiftStart:"10:00 Øµ",shiftEnd:"6:00 Ù…",dayOff:null,role:"doctor"},
  { name:"Ø¯. Ù…Ø§Ø±ÙŠÙ†Ø§",shiftStart:"12:00 Ù…",shiftEnd:"8:00 Ù…",dayOff:null,role:"doctor"},
  { name:"Ø¯. ÙØ§Ø¯ÙŠ",shiftStart:"6:00 Ù…",shiftEnd:"3:00 Øµ",dayOff:null,role:"doctor"},
  { name:"Ø¯. ÙƒØ§ØªÙŠ",shiftStart:"6:00 Ù…",shiftEnd:"3:00 Øµ",dayOff:null,role:"doctor"},
  { name:"ÙØ§Ø¯ÙŠ Ø¹Ù…Ø§Ø¯",shiftStart:"5:00 Ù…",shiftEnd:"3:00 Øµ",dayOff:null,role:"doctor"},
  { name:"Ø¬Ø±Ø¬Ø³ Ù‡Ù„Ø§Ù„",shiftStart:"2:00 Ù…",shiftEnd:"12:00 Øµ",dayOff:null,role:"doctor"},
  { name:"ÙŠÙˆØ³Ù Ø«Ø±ÙˆØª",shiftStart:"10:00 Øµ",shiftEnd:"8:00 Ù…",dayOff:null,role:"doctor"}
];

let logs = [];

function loadData(){
  const saved = localStorage.getItem('attendanceData');
  const todayDate = new Date().toLocaleDateString('ar-EG');
  if(saved){
    const obj = JSON.parse(saved);
    people = obj.people || people;
    if(obj.lastDate === todayDate){
      logs = obj.logs || [];
    } else {
      logs = [];
    }
  }
}

function saveData(){
  const todayDate = new Date().toLocaleDateString('ar-EG');
  localStorage.setItem('attendanceData', JSON.stringify({people,logs,lastDate: todayDate}));
}

const weekdaysAr={"Sunday":"Ø§Ù„Ø£Ø­Ø¯","Monday":"Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Tuesday":"Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Wednesday":"Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Thursday":"Ø§Ù„Ø®Ù…ÙŠØ³","Friday":"Ø§Ù„Ø¬Ù…Ø¹Ø©","Saturday":"Ø§Ù„Ø³Ø¨Øª"};
function dayNameEn(d=new Date()){return d.toLocaleDateString('en-US',{weekday:'long'})}

function toMinutes12h(hm){
  let [time, meridiem] = hm.split(' ');
  let [h, m] = time.split(':').map(Number);
  if(meridiem==='Ù…' && h<12) h+=12;
  if(meridiem==='Øµ' && h===12) h=0;
  return h*60 + (m||0);
}

function formatTime12h(date) {
    let hours = date.getHours();
    let minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
    hours = hours % 12;
    hours = hours ? hours : 12;
    const minutesStr = minutes.toString().padStart(2, '0');
    return hours + ':' + minutesStr + ' ' + ampm;
}

function renderPeople(){
  const tbody=document.querySelector('#peopleTable tbody');tbody.innerHTML='';
  people.forEach((p,idx)=>{
    const tr=document.createElement('tr');
    const sel=document.createElement('select');
    sel.add(new Option('Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯',''));
    Object.keys(weekdaysAr).forEach(d=>{
      const opt=new Option(weekdaysAr[d],d);
      if(p.dayOff===d) opt.selected=true; sel.add(opt);
    });
    sel.onchange=e=>{
      if(isAdmin()) people[idx].dayOff=e.target.value||null;
      else e.target.value=p.dayOff||"";
      saveData();
    };
    let closeInput = document.createElement('input');
    closeInput.type='text';
    closeInput.placeholder='Ø§ÙƒØªØ¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„';
    closeInput.className='reasonInput';
    closeInput.id = 'closeNote-'+p.name;

    tr.innerHTML=`<td>${p.name}</td><td>${p.shiftStart}-${p.shiftEnd}</td><td></td>
      <td></td>
      <td><button class="btn-blue" onclick="sign('${p.name}','${p.shiftStart}','${p.shiftEnd}','${p.role}')">Ø­Ø¶ÙˆØ±</button></td>
      <td><button class="btn-blue" onclick="sign('${p.name}','${p.shiftStart}','${p.shiftEnd}','${p.role}','out')">Ø§Ù†ØµØ±Ø§Ù</button></td>`;
    tr.children[2].appendChild(sel);
    // Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„ØªÙ‚ÙÙŠÙ„ Ù„Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§ ÙˆØ¯. ÙØ§Ø¯ÙŠ
    if(p.name==="Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§" || p.name==="Ø¯. ÙØ§Ø¯ÙŠ") tr.children[3].appendChild(closeInput);
    tbody.appendChild(tr);
  });
}

function renderLogs(){
  const tbody=document.querySelector('#logTable tbody');tbody.innerHTML='';
  logs.forEach(l=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${l.name}</td><td>${l.action}</td><td>${l.time}</td><td>${l.date}</td><td>${l.status}</td><td>${l.reason||'-'}</td>`;
    tbody.appendChild(tr);
  });
}

function sign(name,start,end,role,force){
  const action=force==='out'?'Ø§Ù†ØµØ±Ø§Ù':'Ø­Ø¶ÙˆØ±';
  const now=new Date(); 
  const time=formatTime12h(now);
  const todayDate = now.toLocaleDateString('ar-EG');

  const startMin=toMinutes12h(start),endMin=toMinutes12h(end),currMin=now.getHours()*60+now.getMinutes();
  let adjCurr=currMin;
  if(endMin<=startMin){ if(currMin<startMin) adjCurr+=24*60; }

  if(adjCurr<startMin && action==='Ø­Ø¶ÙˆØ±'){ alert(`Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ ${action} Ù‚Ø¨Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´ÙŠÙØª (${start})`); return; }

  let status='ÙÙŠ Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯',reason='';

  if((action==='Ø­Ø¶ÙˆØ±' && adjCurr>startMin) || (action==='Ø§Ù†ØµØ±Ø§Ù' && adjCurr<endMin)){
    status = (action==='Ø­Ø¶ÙˆØ±')?'ØªØ£Ø®ÙŠØ±':'Ø§Ù†ØµØ±Ø§Ù Ù…Ø¨ÙƒØ±';
    while(!reason){
      reason = prompt(`Ø§Ù„Ø³Ø¨Ø¨ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ù€ ${status}:`,'Ù…Ø«Ø§Ù„: Ù…Ø±Ø¶ / Ø¸Ø±Ù Ø´Ø®ØµÙŠ / Ù†Ù‚Ù„ Ù…Ù‡Ù…Ø©');
      if(!reason) alert('ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø³Ø¨Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©!');
    }
  }

  const today=dayNameEn();
  const person=people.find(p=>p.name===name);
  if(person && person.dayOff===today){alert(`${name} ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ…`);return;}

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„ Ù„Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§ ÙˆØ¯. ÙØ§Ø¯ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù
  if((name==="Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§" || name==="Ø¯. ÙØ§Ø¯ÙŠ") && action==='Ø§Ù†ØµØ±Ø§Ù'){
    const note = document.getElementById("closeNote-"+name).value.trim();
    if(!note){ alert("ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù!"); return; }
    reason += " | ØªÙ‚ÙÙŠÙ„: " + note;
  }

  logs.push({name,action,time,date:todayDate,status,reason,role});
  saveData();
  renderLogs();

  if(action==='Ø­Ø¶ÙˆØ±'){
    const msgDiv = document.createElement('div'); msgDiv.className='messageDiv message-success';
    msgDiv.textContent = "Ø¨Ø§Ø±Ùƒ ÙŠØ§Ø±Ø¨ Ø§Ù„ÙŠÙˆÙ… Ø§ØªÙ…Ù†ÙŠ Ø§Ù„ÙŠÙˆÙ… ÙŠÙ…Ø´ÙŠ Ù…Ø¹Ø§ÙƒÙ… ÙƒÙˆÙŠØ³ â¤ï¸";
    document.body.insertBefore(msgDiv, document.querySelector('.wrap'));
    setTimeout(()=>msgDiv.remove(),3000);
  }
  if(action==='Ø§Ù†ØµØ±Ø§Ù'){
    const msgDiv = document.createElement('div'); msgDiv.className='messageDiv message-info';
    msgDiv.textContent = "Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ Ø¹Ù„Ù‰ ÙŠÙˆÙ…ÙƒØŒ Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ù…Ø³Ø§Ø¡ Ø³Ø¹ÙŠØ¯ ğŸŒ™";
    document.body.insertBefore(msgDiv, document.querySelector('.wrap'));
    setTimeout(()=>msgDiv.remove(),3000);
  }

  alert(`${name} â€” ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${action} (${status})`);
}

function sendWeeklyReport() {
    const phoneNumber = "201113279672"; // Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©
    if(logs.length===0){alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±"); return;}
    let message = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ:\n";
    logs.forEach(l => {
        message += `${l.date} - ${l.name} - ${l.action} - ${l.time} - ${l.status} - ${l.reason}\n`;
    });
    const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
    window.open(url, "_blank");
}

loadData();
renderPeople();
renderLogs();
</script>
</body>
</html>
