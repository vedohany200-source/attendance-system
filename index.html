<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>نظام حضور وانصراف — powred by fady</title>
<style>
:root{
  --bg:#f5f8fb; --card:#fff; --accent:#1565c0; --accent-2:#0288d1; --muted:#6b7785; --danger:#e53935; --ok:#2e7d32;
}
*{box-sizing:border-box}
body{margin:0;padding:14px;font-family:'Segoe UI',Tahoma,Arial,sans-serif;background:var(--bg);color:#0f1720;}
.wrap{max-width:900px;margin:0 auto}
header{display:flex;flex-direction:column;align-items:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;padding:12px;border-radius:10px;text-align:center;position:relative;}
header h1{margin:0;font-size:20px} header .sub{font-size:13px;opacity:.95}
#clock{position:absolute;top:10px;left:10px;font-weight:700}
.card{background:var(--card);border-radius:12px;padding:12px;margin-top:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);border:1px solid rgba(16,24,40,.04);}
h2{margin:0 0 8px;color:var(--accent)}
table{width:100%;border-collapse:collapse;margin-top:8px;font-size:14px}
th,td{padding:6px;border-bottom:1px solid #eef3f7;text-align:center;}
th{background:linear-gradient(180deg,#f7fbff,#f0f6ff);color:var(--accent);font-weight:700}
button{padding:6px 10px;border-radius:6px;border:0;cursor:pointer;font-size:13px;margin:2px;}
.btn-blue{background:var(--accent);color:#fff;}
select,input[type=text]{padding:6px;border-radius:6px;border:1px solid #d7e6f6;background:#fbfeff;font-size:13px;width:100%}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>⚕️ نظام حضور وانصراف</h1>
<div class="sub">نسخة كاملة — powred by fady</div>
<div id="clock"></div>
</header>

<div id="loginCard" class="card">
<h2>تسجيل الدخول بالدكتور</h2>
<input type="text" id="doctorCode" placeholder="ضع كود الدكتور">
<button class="btn-blue" onclick="loginDoctor()">دخول</button>
</div>

<div id="mainContent" style="display:none;">
<div class="card">
<h2>أزرار الحضور والانصراف والإجازة</h2>
<div id="doctorActions"></div>
</div>

<div class="card" id="absenceCard">
<h2>جدول الإجازات</h2>
<table id="absenceTable">
<thead><tr><th>اليوم</th><th>الاسم</th></tr></thead>
<tbody></tbody>
</table>
</div>

<div class="card" id="logCard" style="display:none;">
<h2>سجل اليوم</h2>
<table id="logTable">
<thead><tr><th>الاسم</th><th>نوع</th><th>الوقت</th><th>التاريخ</th><th>الحالة</th><th>السبب</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<footer>
تحت إشراف: دكتور رامي كميل
</footer>
</div>

<script>
const doctors=[
{name:"د. روجينا",shiftStart:"10:00 ص",shiftEnd:"6:00 م",code:"RO12"},
{name:"د. مارينا",shiftStart:"12:00 م",shiftEnd:"8:00 م",code:"MA34"},
{name:"د. فادي",shiftStart:"6:00 م",shiftEnd:"3:00 ص",code:"FA56"},
{name:"د. كاتي",shiftStart:"6:00 م",shiftEnd:"3:00 ص",code:"KA78"},
{name:"فادي ميلاد",shiftStart:"5:00 م",shiftEnd:"3:00 ص",code:"FM90"},
{name:"جرجس هلال",shiftStart:"2:00 م",shiftEnd:"12:00 ص",code:"GH21"},
{name:"يوسف ثروت",shiftStart:"10:00 ص",shiftEnd:"8:00 م",code:"YT11"},
{name:"د. رامي",shiftStart:"",shiftEnd:"",code:"ramy12"}
];

let logs=[]; let absences=[]; let currentDoctor=null;

function updateClock(){
  const now=new Date();
  const h=now.getHours().toString().padStart(2,'0');
  const m=now.getMinutes().toString().padStart(2,'0');
  const s=now.getSeconds().toString().padStart(2,'0');
  document.getElementById('clock').textContent=`${h}:${m}:${s}`;
}
setInterval(updateClock,1000);

function toMinutes12h(hm){
  let [time, meridiem]=hm.split(' '); let [h,m]=time.split(':').map(Number);
  if(meridiem==='م' && h<12) h+=12;
  if(meridiem==='ص' && h===12) h=0;
  return h*60+(m||0);
}

function saveData(){localStorage.setItem('attendanceData',JSON.stringify({logs,absences}));}
function loadData(){const saved=localStorage.getItem('attendanceData');if(saved){const obj=JSON.parse(saved);logs=obj.logs||[];absences=obj.absences||[];}}

loadData();

function loginDoctor(){
  const code=document.getElementById('doctorCode').value.trim();
  const doc=doctors.find(d=>d.code===code);
  if(!doc){alert('كود غير صحيح'); return;}
  currentDoctor=doc;
  document.getElementById('loginCard').style.display='none';
  document.getElementById('mainContent').style.display='block';
  renderDoctorActions();
  renderAbsences();
  if(doc.code==="ramy12") document.getElementById('logCard').style.display='block';
}

function renderDoctorActions(){
  const container=document.getElementById('doctorActions');
  container.innerHTML='';
  const nameDiv=document.createElement('div'); nameDiv.textContent=currentDoctor.name; nameDiv.style.fontSize='18px'; nameDiv.style.fontWeight='700'; container.appendChild(nameDiv);

  const btnPresence=document.createElement('button'); btnPresence.className='btn-blue'; btnPresence.textContent='حضور';
  btnPresence.onclick=()=>markAttendance('حضور'); container.appendChild(btnPresence);

  const btnExit=document.createElement('button'); btnExit.className='btn-blue'; btnExit.textContent='انصراف';
  btnExit.onclick=()=>markAttendance('انصراف'); container.appendChild(btnExit);

  const selDay=document.createElement('select'); selDay.id='absenceSelect';
  selDay.add(new Option('اختر يوم الإجازة',''));
  ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"].forEach(day=>{
    selDay.add(new Option(day,day));
  });
  selDay.onchange=()=>setAbsence(selDay.value);
  container.appendChild(selDay);

  // عرض مواعيد الشيفت
  const shiftDiv=document.createElement('div'); shiftDiv.textContent=`الشيفت: ${currentDoctor.shiftStart} - ${currentDoctor.shiftEnd}`; shiftDiv.style.marginTop='5px'; container.appendChild(shiftDiv);
}

function markAttendance(action){
  const now=new Date(); const todayDate=now.toLocaleDateString('ar-EG');
  const startMin=toMinutes12h(currentDoctor.shiftStart); const endMin=toMinutes12h(currentDoctor.shiftEnd);
  let currMin=now.getHours()*60+now.getMinutes();
  if(endMin<=startMin && currMin<startMin) currMin+=24*60;

  if(action==='حضور'){
    if(logs.find(l=>l.name===currentDoctor.name && l.action==='حضور' && l.date===todayDate)){alert('لقد سجلت حضورك بالفعل اليوم ✅'); return;}
    if(currMin<startMin){alert('لا يمكنك تسجيل الحضور قبل بداية الشيفت'); return;}
    let status='في الميعاد', reason='-';
    if(currMin>startMin){status='تأخير'; while(!reason){reason=prompt('سبب التأخير:');}}
    logs.push({name:currentDoctor.name,action,time:`${now.getHours()}:${now.getMinutes()}`,date:todayDate,status,reason});
  }
  if(action==='انصراف'){
    logs.push({name:currentDoctor.name,action,time:`${now.getHours()}:${now.getMinutes()}`,date:todayDate,status:'انصراف',reason:'-'});
  }
  saveData();
  if(currentDoctor.code==="ramy12") renderLogs();
  alert(`تم تسجيل ${action} بنجاح`);
}

function setAbsence(day){
  if(absences.filter(a=>a.day===day).length>=1){alert('هذا اليوم محجوز بالفعل لشخص آخر'); return;}
  absences.push({name:currentDoctor.name,day}); saveData(); renderAbsences();
}

function renderLogs(){
  const tbody=document.querySelector('#logTable tbody');tbody.innerHTML='';
  logs.forEach(l=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${l.name}</td><td>${l.action}</td><td>${l.time}</td><td>${l.date}</td><td>${l.status}</td><td>${l.reason}</td>`;
    tbody.appendChild(tr);
  });
}

function renderAbsences(){
  const tbody=document.querySelector('#absenceTable tbody');tbody.innerHTML='';
  absences.forEach(a=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${a.day}</td><td>${a.name}</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
