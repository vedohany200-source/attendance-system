<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù â€” powred by fady</title>
<style>
:root{
  --bg:#f5f8fb; --card:#fff; --accent:#1565c0; --accent-2:#0288d1; --muted:#6b7785; --danger:#e53935; --ok:#2e7d32; --warning:#f9a825;
}
*{box-sizing:border-box}
body{margin:0;padding:14px;font-family:'Segoe UI',Tahoma,Arial,sans-serif;background:var(--bg);color:#0f1720}
.wrap{max-width:900px;margin:0 auto}
header{display:flex;flex-direction:column;align-items:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;padding:12px;border-radius:10px;text-align:center;position:relative;}
header h1{margin:0;font-size:18px} 
header .sub{font-size:13px;opacity:.95;}
header .clock{position:absolute;top:12px;left:12px;font-size:14px;font-weight:600;}
.card{background:var(--card);border-radius:12px;padding:12px;margin-top:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);border:1px solid rgba(16,24,40,.04);}
h2{margin:0 0 8px;color:var(--accent)}
table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
th,td{padding:6px;border-bottom:1px solid #eef3f7;text-align:center}
th{background:linear-gradient(180deg,#f7fbff,#f0f6ff);color:var(--accent);font-weight:700}
select,input[type=text]{padding:6px;border-radius:6px;border:1px solid #d7e6f6;background:#fbfeff;font-size:13px;width:100%}
button{padding:6px 10px;border-radius:6px;border:0;cursor:pointer;font-size:13px}
.btn-blue{background:var(--accent);color:#fff;margin:2px;}
.reasonInput{width:90%;margin-top:4px}
footer{margin-top:14px;text-align:center;color:#6b7785;font-weight:600;font-size:13px}
.messageDiv{padding:12px 20px;margin:0 auto 10px;border-radius:6px;color:#fff;font-weight:600;text-align:center;position:fixed;top:10px;left:50%;transform:translateX(-50%);z-index:9999;min-width:300px;box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.message-success{background:#2e7d32;}
.message-info{background:#1565c0;}
.message-danger{background:#e53935;}
.message-warning{background:#f9a825;}
</style>
</head>
<body>
<div class="wrap">
<header>
  <h1>âš•ï¸ Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù</h1>
  <div class="sub">Ù†Ø³Ø®Ø© ÙƒØ§Ù…Ù„Ø© â€” powred by fady</div>
  <div class="clock" id="liveClock">00:00:00</div>
</header>

<div class="card">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h2>
<table id="peopleTable">
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø´ÙŠÙØª</th><th>Ø¥Ø¬Ø§Ø²Ø©</th><th>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„</th><th>Ø­Ø¶ÙˆØ±</th><th>Ø§Ù†ØµØ±Ø§Ù</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr></thead>
<tbody></tbody>
</table>
</div>

<div class="card">
<h2>Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…</h2>
<table id="logTable">
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù†ÙˆØ¹</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø³Ø¨Ø¨</th></tr></thead>
<tbody></tbody>
</table>
<button class="btn-blue" id="weeklyReportBtn" style="display:none;" onclick="sendWeeklyReport()">Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>

<footer>
ØªØ­Øª Ø¥Ø´Ø±Ø§Ù: Ø¯ÙƒØªÙˆØ± Ø±Ø§Ù…ÙŠ ÙƒÙ…ÙŠÙ„
</footer>
</div>

<script>
let currentUser = null;
let logs = [];
let people = [
  { name:"Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§",shiftStart:"10:00 Øµ",shiftEnd:"6:00 Ù…",dayOff:null,role:"doctor"},
  { name:"Ø¯. Ù…Ø§Ø±ÙŠÙ†Ø§",shiftStart:"12:00 Ù…",shiftEnd:"8:00 Ù…",dayOff:null,role:"doctor"},
  { name:"Ø¯. ÙØ§Ø¯ÙŠ",shiftStart:"6:00 Ù…",shiftEnd:"3:00 Øµ",dayOff:null,role:"doctor"},
  { name:"Ø¯. ÙƒØ§ØªÙŠ",shiftStart:"6:00 Ù…",shiftEnd:"3:00 Øµ",dayOff:null,role:"doctor"},
  { name:"ÙØ§Ø¯ÙŠ Ø¹Ù…Ø§Ø¯",shiftStart:"5:00 Ù…",shiftEnd:"3:00 Øµ",dayOff:null,role:"doctor"},
  { name:"Ø¬Ø±Ø¬Ø³ Ù‡Ù„Ø§Ù„",shiftStart:"2:00 Ù…",shiftEnd:"12:00 Øµ",dayOff:null,role:"doctor"},
  { name:"ÙŠÙˆØ³Ù Ø«Ø±ÙˆØª",shiftStart:"10:00 Øµ",shiftEnd:"8:00 Ù…",dayOff:null,role:"doctor"}
];

const userCodes = [
  { name: "Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§", code: "RO12" },
  { name: "Ø¯. Ù…Ø§Ø±ÙŠÙ†Ø§", code: "MR12" },
  { name: "Ø¯. ÙØ§Ø¯ÙŠ", code: "FD18" },
  { name: "Ø¯. ÙƒØ§ØªÙŠ", code: "KT06" },
  { name: "ÙØ§Ø¯ÙŠ Ø¹Ù…Ø§Ø¯", code: "FA05" },
  { name: "Ø¬Ø±Ø¬Ø³ Ù‡Ù„Ø§Ù„", code: "GH02" },
  { name: "ÙŠÙˆØ³Ù Ø«Ø±ÙˆØª", code: "YT10" }
];

const admins = [
  { name: "Ø£Ø¯Ù…Ù†", code: "ramy12" }
];

function formatTime12h(date){
  let h=date.getHours(),m=date.getMinutes(),s=date.getSeconds(),ampm=h>=12?'Ù…':'Øµ';
  h=h%12;h=h?h:12;
  return h+':'+m.toString().padStart(2,'0')+':'+s.toString().padStart(2,'0')+' '+ampm;
}

function updateClock(){document.getElementById('liveClock').textContent=formatTime12h(new Date());}
setInterval(updateClock,1000);updateClock();

function showMessage(text,type){
  const msgDiv=document.createElement('div');msgDiv.className='messageDiv message-'+type;msgDiv.textContent=text;
  document.body.appendChild(msgDiv);setTimeout(()=>msgDiv.remove(),3000);
}

function getCodeFromURL(){const params=new URLSearchParams(window.location.search);return params.get('user');}

function enterCodeFromURL(){
    const code=getCodeFromURL();
    const user=userCodes.find(u=>u.code===code);
    const admin=admins.find(a=>a.code===code);
    if(admin){ currentUser=admin; renderAllPeople(); document.getElementById('weeklyReportBtn').style.display='inline-block'; return; }
    if(!user){ alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­!"); return; }
    currentUser=user;renderUser(user);
}

function renderAllPeople(){
  const tbody=document.querySelector('#peopleTable tbody');tbody.innerHTML='';
  people.forEach(p=>{
    const tr=document.createElement('tr');
    const closeInput=document.createElement('input');closeInput.type='text';closeInput.placeholder='Ø§ÙƒØªØ¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„';closeInput.className='reasonInput';closeInput.id='closeNote-'+p.name;
    tr.innerHTML=`<td>${p.name}</td><td>${p.shiftStart}-${p.shiftEnd}</td><td>${p.dayOff||'-'}</td>
                  <td>${(p.name==="Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§"||p.name==="Ø¯. ÙØ§Ø¯ÙŠ")?closeInput.outerHTML:''}</td>
                  <td>-</td><td>-</td><td>-</td>`;
    tbody.appendChild(tr);
  });
}

function renderUser(user){
  const tbody=document.querySelector('#peopleTable tbody');tbody.innerHTML='';
  const p=people.find(p=>p.name===user.name);
  const tr=document.createElement('tr');
  const closeInput=document.createElement('input');closeInput.type='text';closeInput.placeholder='Ø§ÙƒØªØ¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„';closeInput.className='reasonInput';closeInput.id='closeNote-'+p.name;
  tr.innerHTML=`<td>${p.name}</td><td>${p.shiftStart}-${p.shiftEnd}</td><td></td><td></td>
                 <td><button onclick="sign('${p.name}','${p.shiftStart}','${p.shiftEnd}','${p.role}')">Ø­Ø¶ÙˆØ±</button></td>
                 <td><button onclick="sign('${p.name}','${p.shiftStart}','${p.shiftEnd}','${p.role}','out')">Ø§Ù†ØµØ±Ø§Ù</button></td>
                 <td id="timer-${p.name}"></td>`;
  if(p.name==="Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§"||p.name==="Ø¯. ÙØ§Ø¯ÙŠ") tr.children[3].appendChild(closeInput);
  tbody.appendChild(tr);
  if(user.name==="Ø¯. ÙØ§Ø¯ÙŠ") document.getElementById('weeklyReportBtn').style.display='inline-block';
}

function sign(name,start,end,role,force){
  const action = force==='out' ? 'Ø§Ù†ØµØ±Ø§Ù' : 'Ø­Ø¶ÙˆØ±';
  const now = new Date();
  const time = formatTime12h(now);
  const person = people.find(p=>p.name===name);
  const today=new Date().toLocaleDateString('en-US',{weekday:'long'});
  if(person && person.dayOff===today){alert(`${name} ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ…`);return;}
  
  let reason=''; 
  if(action==='Ø§Ù†ØµØ±Ø§Ù' || action==='Ø­Ø¶ÙˆØ±'){ 
    reason=prompt(`Ø§Ù„Ø³Ø¨Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):`,''); 
  }
  
  if((name==="Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§"||name==="Ø¯. ÙØ§Ø¯ÙŠ") && action==='Ø§Ù†ØµØ±Ø§Ù'){ 
    const note=document.getElementById("closeNote-"+name).value.trim();
    if(!note){ alert("ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù!"); return; }
    if(reason) reason+=" | "; reason+="ØªÙ‚ÙÙŠÙ„: "+note;
  }

  logs.push({name, action, time, date: now.toLocaleDateString('ar-EG'), status:'-', reason:reason||'-', role});
  localStorage.setItem('attendanceData',JSON.stringify({people,logs,lastDate:now.toLocaleDateString('ar-EG')}));
  renderLogs();

  const timerCell = document.getElementById('timer-' + name);
  if(action==='Ø­Ø¶ÙˆØ±' && timerCell){
    let startTime = Date.now();
    timerCell.textContent = '0:00:00';
    setInterval(()=>{
      const diff = Date.now() - startTime;
      const hours = Math.floor(diff / 1000 / 3600);
      const minutes = Math.floor((diff / 1000 / 60) % 60);
      const seconds = Math.floor((diff / 1000) % 60);
      timerCell.textContent = `${hours}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    },1000);
  }

  if(action==='Ø­Ø¶ÙˆØ±') showMessage("Ø¨Ø§Ø±Ùƒ ÙŠØ§Ø±Ø¨ Ø§Ù„ÙŠÙˆÙ… Ø§ØªÙ…Ù†ÙŠ Ø§Ù„ÙŠÙˆÙ… ÙŠÙ…Ø´ÙŠ Ù…Ø¹Ø§ÙƒÙ… ÙƒÙˆÙŠØ³ â¤ï¸",'success');
  if(action==='Ø§Ù†ØµØ±Ø§Ù') showMessage("Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ Ø¹Ù„Ù‰ ÙŠÙˆÙ…ÙƒØŒ Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ù…Ø³Ø§Ø¡ Ø³Ø¹ÙŠØ¯ ğŸŒ™",'info');
}

function renderLogs(){const tbody=document.querySelector('#logTable tbody');tbody.innerHTML='';logs.forEach(l=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${l.name}</td><td>${l.action}</td><td>${l.time}</td><td>${l.date}</td><td>${l.status}</td><td>${l.reason||'-'}</td>`;tbody.appendChild(tr);});}

function sendWeeklyReport(){const phoneNumber="201113279672";if(logs.length===0){alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±");return;}
let message="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ:\n";logs.forEach(l=>{message+=`${l.date} - ${l.name} - ${l.action} - ${l.time} - ${l.status} - ${l.reason}\n`;});
const url=`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;window.open(url,"_blank");}

enterCodeFromURL();
</script>
</body>
</html>
