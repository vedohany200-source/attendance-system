<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>نظام حضور وانصراف</title>
<style>
body{font-family:'Segoe UI',Tahoma,Arial,sans-serif;background:#f5f8fb;margin:0;padding:20px;color:#0f1720;}
.wrap{max-width:900px;margin:0 auto;}
header{text-align:center;margin-bottom:20px;}
h1{font-size:28px;color:#1565c0;margin-bottom:5px;}
.card{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,.08);}
button{padding:10px 15px;border-radius:8px;border:0;cursor:pointer;font-size:16px;margin:5px;background:#1565c0;color:#fff;}
.nameDisplay{font-size:24px;font-weight:700;margin-bottom:10px;transition: font-size .3s;}
.nameDisplay:hover{font-size:32px;}
.shiftDisplay{font-size:18px;color:#1565c0;margin-bottom:10px;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:16px;}
th,td{padding:8px;border:1px solid #ddd;text-align:center;}
th{background:#0288d1;color:#fff;}
.messageDiv{padding:10px;margin:10px 0;border-radius:8px;color:#fff;font-weight:700;text-align:center;}
.message-success{background:#2e7d32;}
.message-info{background:#1565c0;}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>⚕️ نظام حضور وانصراف</h1>
</header>

<div class="card" id="loginCard">
<button onclick="promptCode()">تسجيل دخول الدكتور</button>
</div>

<div class="card" id="attendanceCard" style="display:none;">
<div class="nameDisplay" id="doctorName"></div>
<div class="shiftDisplay" id="shiftInfo"></div>
<button onclick="sign('حضور')">حضور</button>
<button onclick="sign('انصراف')">انصراف</button>
<div style="margin-top:10px;">
يوم الإجازة:
<select id="dayOffSelect">
<option value="">اختر اليوم</option>
<option value="Sunday">الأحد</option>
<option value="Monday">الإثنين</option>
<option value="Tuesday">الثلاثاء</option>
<option value="Wednesday">الأربعاء</option>
<option value="Thursday">الخميس</option>
<option value="Friday">الجمعة</option>
<option value="Saturday">السبت</option>
</select>
<button onclick="setDayOff()">تأكيد</button>
</div>
</div>

<div class="card" id="adminCard" style="display:none;">
<h2>سجل الحضور الكامل (للاَدمن)</h2>
<table id="logTable">
<thead><tr><th>الاسم</th><th>نوع</th><th>الوقت</th><th>التاريخ</th><th>يوم الإجازة</th></tr></thead>
<tbody></tbody>
</table>
<h2>جدول الإجازات لكل الأطباء</h2>
<table id="daysOffTable">
<thead><tr><th>الاسم</th><th>يوم الإجازة</th></tr></thead>
<tbody></tbody>
</table>
</div>

<div class="card" id="allDoctorsOffCard" style="display:none;">
<h2>سجل الغيابات لكل الدكاتره</h2>
<table id="allDaysOffTable">
<thead><tr><th>الاسم</th><th>يوم الإجازة</th></tr></thead>
<tbody></tbody>
</table>
</div>

</div>

<script>
const doctors = [
  {name:"د. روجينا", code:"RO12", daysOff:[], shiftStart:"10:00 ص", shiftEnd:"6:00 م"},
  {name:"د. مارينا", code:"MA34", daysOff:[], shiftStart:"12:00 م", shiftEnd:"8:00 م"},
  {name:"د. فادي", code:"FA56", daysOff:[], shiftStart:"6:00 م", shiftEnd:"3:00 ص"},
  {name:"د. كاتي", code:"KA78", daysOff:[], shiftStart:"6:00 م", shiftEnd:"3:00 ص"},
  {name:"فادي ميلاد", code:"FM90", daysOff:[], shiftStart:"5:00 م", shiftEnd:"3:00 ص"},
  {name:"جرجس هلال", code:"GE23", daysOff:[], shiftStart:"2:00 م", shiftEnd:"12:00 ص"},
  {name:"يوسف ثروت", code:"YO90", daysOff:[], shiftStart:"10:00 ص", shiftEnd:"8:00 م"},
  {name:"د. رامي", code:"ramy12", daysOff:[], shiftStart:"9:00 ص", shiftEnd:"5:00 م"}
];

let currentDoctor=null;
let logs=[];

function loadData(){
  const saved = JSON.parse(localStorage.getItem('attendanceData')||'{}');
  const today = new Date().toLocaleDateString('ar-EG');
  if(saved.logs && saved.lastDate === today){
    logs = saved.logs;
  }else{
    logs=[];
  }
  if(saved.doctors){
    doctors.forEach(d=>{
      const savedDoc = saved.doctors.find(sd=>sd.code===d.code);
      if(savedDoc) d.daysOff = savedDoc.daysOff;
    });
  }
}
function saveData(){
  const today = new Date().toLocaleDateString('ar-EG');
  localStorage.setItem('attendanceData', JSON.stringify({doctors, logs, lastDate: today}));
}

loadData();

function promptCode(){
  const code = prompt("أدخل كود الدكتور:");
  const doc = doctors.find(d=>d.code===code);
  if(!doc){ alert('الكود غير صحيح'); return; }
  currentDoctor = doc;
  document.getElementById('loginCard').style.display='none';
  document.getElementById('attendanceCard').style.display='block';
  document.getElementById('doctorName').textContent = doc.name;
  document.getElementById('shiftInfo').textContent = `شيفتك: ${doc.shiftStart} - ${doc.shiftEnd}`;
  document.getElementById('allDoctorsOffCard').style.display='block';
  if(currentDoctor.code==='ramy12') document.getElementById('adminCard').style.display='block';
  renderLogs();
  renderAllDaysOff();
}

function toMinutes12h(hm){
  let [time, meridiem] = hm.split(' ');
  let [h,m] = time.split(':').map(Number);
  if(meridiem==='م' && h<12) h+=12;
  if(meridiem==='ص' && h===12) h=0;
  return h*60 + (m||0);
}

function sign(action){
  const now = new Date();
  const currMin = now.getHours()*60 + now.getMinutes();
  const startMin = toMinutes12h(currentDoctor.shiftStart);
  const endMin = toMinutes12h(currentDoctor.shiftEnd);
  if(action==='حضور' && currMin<startMin){ alert(`غير مسموح بالتسجيل قبل بداية الشيفت (${currentDoctor.shiftStart})`); return; }
  
  logs.push({name:currentDoctor.name, action, time:now.getHours()+':'+String(now.getMinutes()).padStart(2,'0'), date:now.toLocaleDateString('ar-EG'), dayOff:currentDoctor.daysOff[0]||'-'});
  
  saveData();
  renderLogs();

  const msgDiv = document.createElement('div');
  msgDiv.className='messageDiv '+(action==='حضور'?'message-success':'message-info');
  msgDiv.textContent = action==='حضور'?"بارك الله اليوم! ✨":"شكرًا لك على يومك 🌙";
  document.body.insertBefore(msgDiv, document.querySelector('.wrap'));
  setTimeout(()=>msgDiv.remove(),3000);

  alert(`${currentDoctor.name} — تم تسجيل ${action}`);
}

function setDayOff(){
  const day = document.getElementById('dayOffSelect').value;
  if(!day){ alert("اختر اليوم!"); return; }
  const conflict = doctors.find(d=>d.name!==currentDoctor.name && d.daysOff.includes(day));
  if(conflict){ alert(`اليوم محجوز بالفعل لـ ${conflict.name}`); return; }
  currentDoctor.daysOff = [day];
  saveData();
  renderLogs();
  renderAllDaysOff();
  alert(`تم تحديد يوم الإجازة: ${day}`);
}

function renderLogs(){
  const tbody = document.querySelector('#logTable tbody');
  tbody.innerHTML='';
  logs.forEach(l=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${l.name}</td><td>${l.action}</td><td>${l.time}</td><td>${l.date}</td><td>${l.dayOff}</td>`;
    tbody.appendChild(tr);
  });
}

function renderAllDaysOff(){
  const tbody = document.querySelector('#allDaysOffTable tbody');
  tbody.innerHTML='';
  doctors.forEach(d=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${d.name}</td><td>${d.daysOff[0]||'-'}</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
