<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù</title>
<style>
body{font-family:'Segoe UI',Tahoma,Arial,sans-serif;background:#f5f8fb;margin:0;padding:20px;color:#0f1720;}
.wrap{max-width:900px;margin:0 auto;}
header{text-align:center;margin-bottom:20px;}
h1{font-size:28px;color:#1565c0;margin-bottom:5px;}
.card{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,.08);}
button{padding:10px 15px;border-radius:8px;border:0;cursor:pointer;font-size:16px;margin:5px;background:#1565c0;color:#fff;}
.nameDisplay{font-size:24px;font-weight:700;margin-bottom:10px;transition: font-size .3s;}
.nameDisplay:hover{font-size:32px;}
.shiftDisplay{font-size:18px;color:#1565c0;margin-bottom:10px;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:16px;}
th,td{padding:8px;border:1px solid #ddd;text-align:center;}
th{background:#0288d1;color:#fff;}
.messageDiv{padding:10px;margin:10px 0;border-radius:8px;color:#fff;font-weight:700;text-align:center;}
.message-success{background:#2e7d32;}
.message-info{background:#1565c0;}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>âš•ï¸ Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù</h1>
</header>

<div class="card" id="loginCard">
<button onclick="promptCode()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯ÙƒØªÙˆØ±</button>
</div>

<div class="card" id="attendanceCard" style="display:none;">
<div class="nameDisplay" id="doctorName"></div>
<div class="shiftDisplay" id="shiftInfo"></div>
<button onclick="sign('Ø­Ø¶ÙˆØ±')">Ø­Ø¶ÙˆØ±</button>
<button onclick="sign('Ø§Ù†ØµØ±Ø§Ù')">Ø§Ù†ØµØ±Ø§Ù</button>
<div style="margin-top:10px;">
ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©:
<select id="dayOffSelect">
<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</option>
<option value="Sunday">Ø§Ù„Ø£Ø­Ø¯</option>
<option value="Monday">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option>
<option value="Tuesday">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
<option value="Wednesday">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
<option value="Thursday">Ø§Ù„Ø®Ù…ÙŠØ³</option>
<option value="Friday">Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
<option value="Saturday">Ø§Ù„Ø³Ø¨Øª</option>
</select>
<button onclick="setDayOff()">ØªØ£ÙƒÙŠØ¯</button>
</div>
</div>

<div class="card" id="adminCard" style="display:none;">
<h2>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„ (Ù„Ù„Ø§ÙØ¯Ù…Ù†)</h2>
<table id="logTable">
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù†ÙˆØ¹</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</th></tr></thead>
<tbody></tbody>
</table>
<h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ù„ÙƒÙ„ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h2>
<table id="daysOffTable">
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</th></tr></thead>
<tbody></tbody>
</table>
</div>

<div class="card" id="allDoctorsOffCard" style="display:none;">
<h2>Ø³Ø¬Ù„ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª Ù„ÙƒÙ„ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ù‡</h2>
<table id="allDaysOffTable">
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</th></tr></thead>
<tbody></tbody>
</table>
</div>

</div>

<script>
const doctors = [
  {name:"Ø¯. Ø±ÙˆØ¬ÙŠÙ†Ø§", code:"RO12", daysOff:[], shiftStart:"10:00 Øµ", shiftEnd:"6:00 Ù…"},
  {name:"Ø¯. Ù…Ø§Ø±ÙŠÙ†Ø§", code:"MA34", daysOff:[], shiftStart:"12:00 Ù…", shiftEnd:"8:00 Ù…"},
  {name:"Ø¯. ÙØ§Ø¯ÙŠ", code:"FA56", daysOff:[], shiftStart:"6:00 Ù…", shiftEnd:"3:00 Øµ"},
  {name:"Ø¯. ÙƒØ§ØªÙŠ", code:"KA78", daysOff:[], shiftStart:"6:00 Ù…", shiftEnd:"3:00 Øµ"},
  {name:"ÙØ§Ø¯ÙŠ Ù…ÙŠÙ„Ø§Ø¯", code:"FM90", daysOff:[], shiftStart:"5:00 Ù…", shiftEnd:"3:00 Øµ"},
  {name:"Ø¬Ø±Ø¬Ø³ Ù‡Ù„Ø§Ù„", code:"GE23", daysOff:[], shiftStart:"2:00 Ù…", shiftEnd:"12:00 Øµ"},
  {name:"ÙŠÙˆØ³Ù Ø«Ø±ÙˆØª", code:"YO90", daysOff:[], shiftStart:"10:00 Øµ", shiftEnd:"8:00 Ù…"},
  {name:"Ø¯. Ø±Ø§Ù…ÙŠ", code:"ramy12", daysOff:[], shiftStart:"9:00 Øµ", shiftEnd:"5:00 Ù…"}
];

let currentDoctor=null;
let logs=[];

function loadData(){
  const saved = JSON.parse(localStorage.getItem('attendanceData')||'{}');
  const today = new Date().toLocaleDateString('ar-EG');
  if(saved.logs && saved.lastDate === today){
    logs = saved.logs;
  }else{
    logs=[];
  }
  if(saved.doctors){
    doctors.forEach(d=>{
      const savedDoc = saved.doctors.find(sd=>sd.code===d.code);
      if(savedDoc) d.daysOff = savedDoc.daysOff;
    });
  }
}
function saveData(){
  const today = new Date().toLocaleDateString('ar-EG');
  localStorage.setItem('attendanceData', JSON.stringify({doctors, logs, lastDate: today}));
}

loadData();

function promptCode(){
  const code = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙƒØªÙˆØ±:");
  const doc = doctors.find(d=>d.code===code);
  if(!doc){ alert('Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­'); return; }
  currentDoctor = doc;
  document.getElementById('loginCard').style.display='none';
  document.getElementById('attendanceCard').style.display='block';
  document.getElementById('doctorName').textContent = doc.name;
  document.getElementById('shiftInfo').textContent = `Ø´ÙŠÙØªÙƒ: ${doc.shiftStart} - ${doc.shiftEnd}`;
  document.getElementById('allDoctorsOffCard').style.display='block';
  if(currentDoctor.code==='ramy12') document.getElementById('adminCard').style.display='block';
  renderLogs();
  renderAllDaysOff();
}

function toMinutes12h(hm){
  let [time, meridiem] = hm.split(' ');
  let [h,m] = time.split(':').map(Number);
  if(meridiem==='Ù…' && h<12) h+=12;
  if(meridiem==='Øµ' && h===12) h=0;
  return h*60 + (m||0);
}

function sign(action){
  const now = new Date();
  const currMin = now.getHours()*60 + now.getMinutes();
  const startMin = toMinutes12h(currentDoctor.shiftStart);
  const endMin = toMinutes12h(currentDoctor.shiftEnd);
  if(action==='Ø­Ø¶ÙˆØ±' && currMin<startMin){ alert(`ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù‚Ø¨Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´ÙŠÙØª (${currentDoctor.shiftStart})`); return; }
  
  logs.push({name:currentDoctor.name, action, time:now.getHours()+':'+String(now.getMinutes()).padStart(2,'0'), date:now.toLocaleDateString('ar-EG'), dayOff:currentDoctor.daysOff[0]||'-'});
  
  saveData();
  renderLogs();

  const msgDiv = document.createElement('div');
  msgDiv.className='messageDiv '+(action==='Ø­Ø¶ÙˆØ±'?'message-success':'message-info');
  msgDiv.textContent = action==='Ø­Ø¶ÙˆØ±'?"Ø¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ Ø§Ù„ÙŠÙˆÙ…! âœ¨":"Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ Ø¹Ù„Ù‰ ÙŠÙˆÙ…Ùƒ ğŸŒ™";
  document.body.insertBefore(msgDiv, document.querySelector('.wrap'));
  setTimeout(()=>msgDiv.remove(),3000);

  alert(`${currentDoctor.name} â€” ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${action}`);
}

function setDayOff(){
  const day = document.getElementById('dayOffSelect').value;
  if(!day){ alert("Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…!"); return; }
  const conflict = doctors.find(d=>d.name!==currentDoctor.name && d.daysOff.includes(day));
  if(conflict){ alert(`Ø§Ù„ÙŠÙˆÙ… Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù€ ${conflict.name}`); return; }
  currentDoctor.daysOff = [day];
  saveData();
  renderLogs();
  renderAllDaysOff();
  alert(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©: ${day}`);
}

function renderLogs(){
  const tbody = document.querySelector('#logTable tbody');
  tbody.innerHTML='';
  logs.forEach(l=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${l.name}</td><td>${l.action}</td><td>${l.time}</td><td>${l.date}</td><td>${l.dayOff}</td>`;
    tbody.appendChild(tr);
  });
}

function renderAllDaysOff(){
  const tbody = document.querySelector('#allDaysOffTable tbody');
  tbody.innerHTML='';
  doctors.forEach(d=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${d.name}</td><td>${d.daysOff[0]||'-'}</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
